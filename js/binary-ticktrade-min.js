angular.module("binary",["ionic","pascalprecht.translate","hmTouchEvents","ngIOS9UIWebViewPatch"]),angular.module("binary").run(["$rootScope","$ionicPlatform","$state","alertService","accountService","appStateService",function(t,e,n,o,r,a){e.ready(function(){"undefined"!=typeof analytics?analytics.startTrackerWithId("UA-40877026-7"):console.log("Google Analytics Unavailable"),e.registerBackButtonAction(function(){if("options"===n.current.name)o.confirmExit(function(t){1==t&&navigator.app.exitApp()});else if("signin"===n.current.name||"home"===n.current.name)navigator.app.exitApp();else{if("trade"===n.current.name&&a.purchaseMode)return;"trade"!==n.current.name||a.purchaseMode||a.tradeMode?navigator.app.backHistory():(a.tradeMode=!0,t.$$phase||t.$apply())}},100),t.$on("$stateChangeStart",function(t,e,o,a,i){"signin"==e.name||"help"==e.name||r.getDefault()||(t.preventDefault(),n.go("signin"))})})}]),angular.module("ngIOS9UIWebViewPatch",["ng"]).config(["$provide",function(t){"use strict";t.decorator("$browser",["$delegate","$window",function(t,e){function n(t){return/(iPhone|iPad|iPod).* OS 9_\d/.test(t)&&!/Version\/9\./.test(t)}function o(t){function e(){n=null}var n=null,o=t.url;return t.url=function(){return arguments.length?(n=arguments[0],o.apply(t,arguments)):n||o.apply(t,arguments)},window.addEventListener("popstate",e,!1),window.addEventListener("hashchange",e,!1),t}return n(e.navigator.userAgent)?o(t):t}])}]),angular.module("binary").constant("config",{tradeCategories:[{name:"Up/Down",value:"UP/DOWN"},{name:"Digit Match/Differs",value:"MATCH/DIFF",digits:!0},{name:"Digit Even/Odd",value:"EVEN/ODD"},{name:"Digit Over/Under",value:"OVER/UNDER",digits:!0}],tradeTypes:[{name:"Up",value:"CALL",markets:["forex","random"],digits:!1,category:"UP/DOWN"},{name:"Down",value:"PUT",markets:["forex","random"],digits:!1,category:"UP/DOWN"},{name:"Digit Match",value:"DIGITMATCH",markets:["random"],digits:!0,category:"MATCH/DIFF"},{name:"Digit Differs",value:"DIGITDIFF",markets:["random"],digits:!0,category:"MATCH/DIFF"},{name:"Digit Even",value:"DIGITEVEN",markets:["random"],category:"EVEN/ODD"},{name:"Digit Odd",value:"DIGITODD",markets:["random"],category:"EVEN/ODD"},{name:"Digit Over",value:"DIGITOVER",markets:["random"],digits:!0,category:"OVER/UNDER"},{name:"Digit Under",value:"DIGITUNDER",markets:["random"],digits:!0,category:"OVER/UNDER"}],language:"en",assetIndexes:{symbol:0,displayName:1,contracts:2,contractName:0,contractDisplayName:1,contractFrom:2,contractTo:3}}),angular.module("binary").config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/home",templateUrl:"templates/pages/home.html",controller:"HomeController"}).state("signin",{url:"/sign-in",templateUrl:"templates/pages/sign-in.html",controller:"SignInController"}).state("help",{url:"/help",templateUrl:"templates/pages/help.html",controller:"HelpController"}).state("trade",{url:"/trade",cache:!1,templateUrl:"templates/pages/trade.html",controller:"TradeController"}).state("options",{url:"/options",cache:!1,templateUrl:"templates/pages/options.html",controller:"OptionsController"}).state("accounts",{url:"/accounts",cache:!1,templateUrl:"templates/pages/accounts.html",controller:"AccountsController"}),e.otherwise("/home")}]),angular.module("binary").config(["$translateProvider",function(t){var e=localStorage.language||"en";t.preferredLanguage(e),t.useStaticFilesLoader({prefix:"i18n/",suffix:".json"})}]),angular.module("binary").controller("AccountsController",["$scope","$rootScope","$state","$window","$ionicPopup","websocketService","accountService","alertService","proposalService","appStateService","marketService",function(t,e,n,o,r,a,i,s,c,l,u){"undefined"!=typeof analytics&&analytics.trackView("Account Management"),t.navigateToOptionsPage=function(){n.go("options",{},{reload:!0})},t.logout=function(){s.confirmRemoveAllAccount(function(t){"boolean"!=typeof t&&(t=1==t?!0:!1),t&&(i.removeAll(),c.remove(),u.removeActiveSymbols(),u.removeAssetIndex(),l.isLoggedin=!1,n.go("signin"))})}}]),angular.module("binary").controller("HelpController",["$scope","$state",function(t,e){"undefined"!=typeof analytics&&analytics.trackView("Help"),t.backToSignInPage=function(){e.go("signin")},t.openExternal=function(t){return window.open(t.currentTarget.href,"_system"),!1}}]),angular.module("binary").controller("HomeController",["$scope","$state","websocketService","accountService",function(t,e,n,o){var r=function(){"undefined"!=typeof analytics&&analytics.trackView("Home"),n.init(),o.hasDefault()?o.validate():e.go("signin")};r(),t.$on("authorize",function(t,n){n?e.go("options"):e.go("signin")})}]),angular.module("binary").controller("OptionsController",["$scope","$rootScope","$state","$window","config","proposalService","accountService","websocketService","chartService","delayService","appStateService",function(t,e,n,o,r,a,i,s,c,l,u){function p(){u.isLoggedin?(s.sendRequestFor.symbols(),s.sendRequestFor.assetIndex()):setTimeout(p,500)}function d(){var e=a.get();if(e){t.selected={symbol:e.symbol,tradeType:e.contract_type,tick:e.duration,basis:e.basis,market:e.passthrough.market,digit:e.digit};var n=_.find(r.tradeTypes,["value",e.contract_type]);n&&(t.selected.tradeCategory=n.category),e.barrier&&(t.selected.barrier=e.barrier)}}t.selected={},t.isDataLoaded=!1,t.letsTrade=!1,"undefined"!=typeof analytics&&analytics.trackView("Options"),s.sendRequestFor.forgetAll("ticks"),l.update("symbolsAndAssetIndexUpdate",function(){p()},6e4),d(),t.navigateToManageAccounts=function(){n.go("accounts")},t.navigateToTradePage=function(){n.go("trade")},t.saveChanges=function(){var e={symbol:t.selected.symbol,contract_type:t.selected.tradeType,duration:t.selected.tick,basis:t.selected.basis,currency:i.getDefault().currency,passthrough:{market:t.selected.market},digit:t.selected.digit,barrier:t.selected.barrier};a.update(e)},t.$on("connection:reopened",function(t){}),t.$watch("selected",function(e,n){angular.equals(e,n)||t.saveChanges()},!0),t.setDataLoaded=function(e,n){t.isDataLoaded=e,t.letsTrade=_.isNil(n)?e:n}}]),angular.module("binary").controller("SignInController",["$scope","$state",function(t,e){"undefined"!=typeof analytics&&analytics.trackView("Singin"),t.navigateToHelpPage=function(){e.go("help")}}]),angular.module("binary").controller("TradeController",["$scope","$state","$ionicSlideBoxDelegate","marketService","proposalService","websocketService","accountService","alertService","appStateService",function(t,e,n,o,r,a,i,s,c){function l(t){if(c.isLoggedin){var e={};e.date_from=(new Date).toISOString().slice(0,10),e.date_to=e.date_from,e.limit=10,e.passthrough={isConnectionReopen:!0},a.sendRequestFor.profitTable(e)}else setTimeout(l,500)}c.waitForProposal=!1,window.addEventListener("native.keyboardhide",function(e){t.hideFooter=!1,t.$apply()}),window.addEventListener("native.keyboardshow",function(e){t.hideFooter=!0,t.$apply()}),t.setTradeMode=function(t){c.tradeMode=t},t.getTradeMode=function(){return c.tradeMode};var u=function(){"undefined"!=typeof analytics&&analytics.trackView("Trade"),t.proposalToSend=JSON.parse(localStorage.proposal),t.setTradeMode(!0),c.purchaseMode=!1,r.getCurrencies()};u(),t.$on("proposal",function(e,n){t.proposalRecieved=n,c.waitForProposal=!1,t.$apply()}),t.$on("currencies",function(e,n){if(n&&n.length>0){t.currency=n[0],t.$apply();var o=r.get();o&&(o.currency=n[0],r.update(o),r.send())}}),a.sendRequestFor.forgetAll("balance"),a.sendRequestFor.balance(),t.$on("balance",function(e,n){t.account=n,t.$apply()}),t.$on("purchase",function(e,n){n.buy?(t.setTradeMode(!1),c.purchaseMode=!0,t.contract={contract_id:n.buy.contract_id,longcode:n.buy.longcode,payout:t.proposalRecieved.payout,cost:n.buy.buy_price,profit:parseFloat(t.proposalRecieved.payout)-parseFloat(n.buy.buy_price),balance:n.buy.balance_after,transaction_id:n.buy.transaction_id},a.sendRequestFor.portfolio(),t.$apply()):n.error?(s.displayError(n.error.message),$(".contract-purchase button").attr("disabled",!1),r.send()):(s.contractError.notAvailable(),$(".contract-purchase button").attr("disabled",!1)),a.sendRequestFor.balance()}),t.$on("purchase:error",function(t,e){$(".contract-purchase button").attr("disabled",!1),c.purchaseMode=!1,r.send()}),t.$on("contract:finished",function(e,n){n.exitSpot&&("win"===n.result?(t.contract.buyPrice=t.contract.cost,t.contract.profit=t.contract.profit,t.contract.finalPrice=t.contract.buyPrice+t.contract.profit,a.sendRequestFor.openContract()):"lose"===n.result&&(t.contract.buyPrice=t.contract.cost,t.contract.loss=-1*t.contract.cost,t.contract.finalPrice=t.contract.buyPrice+t.contract.loss),t.contract.result=n.result,c.purchaseMode=!1,r.send(),t.$$phase||t.$apply())}),t.$on("proposal:open-contract",function(t,e){e.is_expired&&a.sendRequestFor.sellExpiredContract()}),t.navigateToOptionsPage=function(t){e.go("options")},t.$on("connection:ready",function(e){i.hasDefault()&&(i.validate(),t.proposalToSend=JSON.parse(localStorage.proposal),r.send(),c.purchaseMode&&l())}),t.$on("profit_table:update",function(e,n,o){if(o.hasOwnProperty("isConnectionReopen")&&o.isConnectionReopen)if(n.count>0){if(c.purchaseMode){var r=_.find(n.transactions,["transaction_id",t.contract.transaction_id]);if(r){var a={};a.exitSpot=!0,a.result=r.sell_price>0?"win":"lose",t.$broadcast("contract:finished",a)}}}else c.purchaseMode=!1,c.tradeMode=!0}),t.isContractFinished=function(){return!c.purchaseMode},t.getWaitForProposal=function(){return c.waitForProposal}}]),angular.module("binary").filter("customCurrency",["$filter",function(t){return function(e,n){var o=t("currency");return 0>e?o(e,n).replace("(","-").replace(")",""):o(e,n)}}]),angular.module("binary").service("accountService",["websocketService",function(t){var e=function(t,e,n){var o=-1;return t.forEach(function(r,a){t[a][e]===n&&(o=a)}),o},n=function(){return localStorage.accounts&&JSON.parse(localStorage.accounts)instanceof Array};this.getAll=function(){return n()?JSON.parse(localStorage.accounts):[]},this.removeAll=function(){localStorage.removeItem("accounts")};var o=function(n,o){if(n)t.authenticate(n,o);else{var r=this.getAll(),a=e(r,"is_default",!0);if(a>-1){var i=r[a].token;t.authenticate(i,o)}}};this.validate=function(t,n){if(!t){var r=this.getAll(),a=e(r,"is_default",!0);a>-1&&(t=r[a].token)}o(t,n)},this.add=function(t){var e={id:t.loginid,token:t.token,currency:t.currency,email:t.email,is_default:!1},n=this.getAll();n.push(e),localStorage.accounts=JSON.stringify(n)},this.remove=function(t){var n=this.getAll(),o=e(n,"token",t);o>-1&&n[o].is_default!==!0&&(n.splice(o,1),localStorage.accounts=JSON.stringify(n))},this.setDefault=function(t){var n=this.getAll(),o=e(n,"token",t);o>-1&&(n.forEach(function(e,o){n[o].is_default=n[o].token===t?!0:!1}),localStorage.accounts=JSON.stringify(n))},this.hasDefault=function(){var t=this.getAll(),n=e(t,"is_default",!0);return n>-1?!0:!1},this.getDefault=function(){var t=this.getAll(),n=e(t,"is_default",!0);return t[n]},this.isUnique=function(t){var n=this.getAll(),o=e(n,"id",t);return o>-1?!1:!0}}]),angular.module("binary").service("alertService",["$translate","$ionicPopup","$rootScope",function(t,e,n){var o=function(t,n){if(void 0===navigator.notification){e.alert({title:t,template:n})}else navigator.notification.alert(n,null,t,"OK")},r=function(t,n,o,r){if(void 0===navigator.notification){var a=e.confirm({title:t,template:n});a.then(r)}else navigator.notification.confirm(n,r,t,o)};this.displayError=function(e){t(["alert.error"]).then(function(t){o(t["alert.error"],e)})},this.displaySymbolWarning=function(e,n){t(["alert.warning",e]).then(function(t){o(t["alert.warning"],t[e])})},this.accountError={tokenNotValid:function(){t(["alert.error","alert.not_valid"]).then(function(t){o(t["alert.error"],t["alert.not_valid"])})},tokenNotAuthenticated:function(){t(["alert.error","alert.not_auth"]).then(function(t){o(t["alert.error"],t["alert.not_auth"])})},tokenNotUnique:function(){t(["alert.error","alert.not_unique"]).then(function(t){o(t["alert.error"],t["alert.not_unique"])})}},this.contractError={notAvailable:function(){t(["alert.error","alert.contract_error"]).then(function(t){o(t["alert.error"],t["alert.contract_error"])})}},this.optionsError={noTick:function(){t(["alert.error","alert.no_tick"]).then(function(t){o(t["alert.error"],t["alert.no_tick"])})}},this.displayAlert=function(t,e){o(t,e)},this.confirmAccountRemoval=function(e){t(["alert.remove_token_title","alert.remove_token_content"]).then(function(t){r(t["alert.remove_token_title"],t["alert.remove_token_content"],["Yes","No"],function(t){"boolean"!=typeof t&&(1==t||(t=!1)),t&&(console.log("You are sure"),n.$broadcast("token:remove",e))})})},this.confirmRemoveAllAccount=function(e){t(["alert.remove_all_tokens_title","alert.remove_all_tokens_content"]).then(function(t){r(t["alert.remove_all_tokens_title"],t["alert.remove_all_tokens_content"],["Yes","No"],e)})},this.confirmExit=function(e){t(["app.exit_title","app.exit_confirmation"]).then(function(t){r(t["app.exit_title"],t["app.exit_confirmation"],["Yes","No"],e)})}}]),angular.module("binary").factory("appStateService",function(){var t={};return t.tradeMode=!0,t.purchaseMode=!1,t.isLoggedin=!1,t.waitForProposal=!1,t}),angular.module("binary").factory("appVersionService",["$http",function(t){function e(){return t.get("js/config.json")}var n={};return n.getAppVersion=e,n}]),angular.module("binary").factory("chartService",["$rootScope",function(t){var e,n,o,r=[],a=function(t){return o.tickCount-1-t},i=function(t){var e=Math.ceil(o.tickCount/o.minTickCount);return a(t)%e===0?!0:!1},s=function(){o={chartJS:null,capacity:600,maxTickCount:50,hideLabelsThreshold:15,tickCount:15,minTickCount:5,chartData:{labels:[],labelsFilter:function(t){return!i(t)},datasets:[{strokeColor:"orange",pointColor:"orange",pointStrokeColor:"#fff",data:[]}]},chartOptions:{animation:!1,bezierCurve:!1,datasetFill:!1,showTooltips:!1,keepAspectRatio:!1,scaleShowLabels:!1}}};s();var c={zeroPad:function(t){return 10>t?"0"+t:t.toString()},getTickTime:function(t){var e=new Date(1e3*t);return e.getUTCHours()+":"+c.zeroPad(e.getUTCMinutes())+":"+c.zeroPad(e.getUTCSeconds())},isDefined:function(t){return"undefined"==typeof t||null===t?!1:!0},setObjValue:function(t,e,n,o){c.isDefined(t)&&(c.isDefined(o)?o&&(t[e]=n):"undefined"==typeof t[e]&&(t[e]=n))},fractionalLength:function(t){var e=t.toString(),n=e.indexOf(".");return e.length-n-1},maxFractionalLength:function(t){var e=0;return t.forEach(function(t){e=e<c.fractionalLength(t)?c.fractionalLength(t):e}),e},lastDigit:function(t){return parseInt(t.toString().slice(-1)[0])},conditions:{CALL:function(t,e){return parseFloat(e)>parseFloat(t)},PUT:function(t,e){return parseFloat(e)<parseFloat(t)},DIGITMATCH:function(t,e){return c.lastDigit(t)===c.lastDigit(e)},DIGITDIFF:function(t,e){return c.lastDigit(t)!==c.lastDigit(e)},DIGITEVEN:function(t,e){return c.lastDigit(e)%2===0},DIGITODD:function(t,e){return c.lastDigit(e)%2!==0},DIGITUNDER:function(t,e){return c.lastDigit(e)<parseInt(t)},DIGITOVER:function(t,e){return c.lastDigit(e)>parseInt(t)}},digitTrade:function(t){return 0===t.type.indexOf("DIGIT")?!0:!1},getRelativeIndex:function(t,e){return t-(n.getCapacity()-(n.getTickCount()+n.getDataIndex()))},getAbsoluteIndex:function(t,e){return t+(n.getCapacity()-(n.getTickCount()+n.getDataIndex()))}},l=function(){var t=0,e=0,n=0,o=!1,r=0,a=function(t,r){e=r,n=t,o=!0},i=function(r,a){return o?n+Math.floor((a-e)/t)-r:0},s=function(e,n){null!==e&&(t=Math.ceil(e.offsetWidth/n))},c=function(){return t},l=function(t,e){return t.timeStamp-r>100?(r=t.timeStamp,!0):!1},u=function(){o=!1};return{isStep:l,stop:u,setDistance:s,getDistance:c,setStartPosition:a,stepCount:i}},u=function(t){var e=[],n=function(t){parseInt(t.epoch)>parseInt(e.slice(-1)[0].time)&&(e.push({time:t.epoch,price:t.quote}),e.shift())},o=function(t,e){var n=e.times,o=e.prices,r=function(t,e){var n=parseInt(t.time),o=parseInt(e.time);return o>n?-1:n>o?1:0},a=[];n.forEach(function(e,n){a.indexOf(e)<0&&(a.push(e),t.push({time:e,price:o[n]}))}),n.sort(r)},r=function(t){e=[],o(e,t)},a=function(n,o,r){var a=t-n,i=a-o;r(i>=0?e.slice(i,a):[])};return{getHistory:a,addTick:n,addHistory:r}},p=function(e){var o=!0,a=function(){return o=!1},i=function(){return c.isDefined(e.exitSpot)},s=function(){return e},l=function(){e.showingEntrySpot=!1,e.showingExitSpot=!1},u=function(){return c.isDefined(e.entrySpotIndex)?!0:!1},p=function(){return c.isDefined(e.exitSpotIndex)?!0:!1},d=function(t){return u()&&t>=e.entrySpotTime&&(!p()||t<=e.exitSpot)?!0:!1},f=function(t){return e.showingEntrySpot&&e.entrySpotIndex===c.getAbsoluteIndex(t)?!0:e.showingExitSpot&&e.exitSpotIndex===c.getAbsoluteIndex(t)?!0:!1},g=function(t){var n;return e.showingEntrySpot&&(n=t[c.getRelativeIndex(e.entrySpotIndex)]),n},h=function(t){var n;return e.showingExitSpot&&(n=t[c.getRelativeIndex(e.exitSpotIndex)]),n},m=function(t){return u()?t===e.entrySpotTime?!0:!1:t>=e.startTime?!0:!1},y=function(t,n){return p()?t===e.exitSpot?!0:!1:u()&&n===e.entrySpotIndex+e.duration?!0:!1},v=function(t,o){m(o)?(e.showingEntrySpot=!0,c.digitTrade(e)||p()||n.addGridLine({color:"blue",label:"barrier: "+e.barrier,orientation:"horizontal",index:t})):y(o,c.getAbsoluteIndex(t))&&(e.showingExitSpot=!0)},S=function(t,n,o){(m(n)||d(n))&&(m(n)?(c.setObjValue(e,"barrier",o,!c.digitTrade(e)),c.setObjValue(e,"entrySpotTime",n,!u())):y(n,t)&&c.setObjValue(e,"exitSpot",n,!p()),c.setObjValue(e,"entrySpotIndex",t,m(n)),c.setObjValue(e,"exitSpotIndex",t,y(n,t)))},b=function(){if(u()){var t="win"===e.result?"rgba(0, 255, 0, 0.2)":"rgba(255, 0, 0, 0.2)";if(e.showingExitSpot){var o=c.getRelativeIndex(e.entrySpotIndex);o=0>o?0:o,c.isDefined(e.region)?(e.region.color=t,e.region.start=o):e.region={color:t,start:o},e.region.end=c.getRelativeIndex(e.exitSpotIndex),n.addRegion(e.region)}else e.showingEntrySpot?(c.isDefined(e.region)?(e.region.color=t,e.region.start=c.getRelativeIndex(e.entrySpotIndex)):e.region={color:t,start:c.getRelativeIndex(e.entrySpotIndex)},n.addRegion(e.region)):n.removeRegion(e.region)}},k=function(n,s){u()&&d(n)&&(c.conditions[e.type](e.barrier,s)?e.result="win":e.result="lose",i()&&o&&(r.forEach(function(t,n){var o=t.getContract();e===o||t.isFinished()||a()}),o&&t.$broadcast("contract:finished",e)))};return{setNotBroadcastable:a,isFinished:i,getContract:s,isSpot:f,betweenExistingSpots:d,resetSpotShowing:l,addSpots:S,addRegions:k,viewSpots:v,viewRegions:b,getEntrySpotPoint:g,getExitSpotPoint:h}},d=function(){var t,n,i=0,d=!1,f=!1,g=l(),h=function(t){return 0===a(t)?!0:!1},m=function(){return o.tickCount>=o.hideLabelsThreshold?!0:!1},y=function(){return 0===i?!1:!0},v=function(t){var e="black";return!y()&&h(t)&&(e="green"),r.forEach(function(n){n.isSpot(t)&&(e="blue")}),e},S=function(t,e){var n;return r.forEach(function(e){e.betweenExistingSpots(t)&&(n="blue")}),c.isDefined(n)?n:n=h(e)&&!y()?"green":"orange"},b=function(t,e){var o,r,a,i=t.scale.endPoint-t.scale.startPoint+12;a=t.datasets[0].points[e.start].x,r=c.isDefined(e.end)?t.datasets[0].points[e.end].x:t.datasets[0].points.slice(-1)[0].x,a>=r||(o=r-a,n.fillStyle=e.color,n.fillRect(a,t.scale.startPoint-12,o,i))},k=function(t,e){return{width:t.measureText(e.value).width,height:parseInt(t.font)}},$=function(t,e){return t.s<e.e&&t.e>e.s||e.s<t.e&&e.e>t.s},D=function(t,e){var o=k(n,t),r=k(n,e),a=$({s:t.y,e:t.y+o.height},{s:e.y,e:e.y+r.height}),i=$({s:t.x,e:t.x+o.width},{s:e.x,e:e.x+r.width});return i&&a},T=function(t){var e=[],n=[];return r.forEach(function(o){var r,a;r=o.getEntrySpotPoint(t),a=o.getExitSpotPoint(t),c.isDefined(r)&&e.push(r),c.isDefined(a)&&n.push(a)}),{entries:e,exits:n}},_=function(t,e){var n=!0;return t.forEach(function(t,o){D(t,e)&&(n=!1)}),n},x=function(t){var e=[],n=T(t);n.exits.forEach(function(t,n){e.push(t)}),n.entries.forEach(function(t,n){_(e,t)&&e.push(t)});var o=t.slice(-1)[0];if(!y()&&_(e,o)&&e.push(o),!m())for(var r=t.length-1;r>=0;r--)_(e,t[r])&&e.push(t[r]);e.forEach(function(t,e){t.shown=!0})},w=function(t,e){if(0!==e&&c.isDefined(t.shown)&&t.shown){n.fillStyle=v(e),n.textAlign="center",n.textBaseline="bottom";var o=0,r=k(n,t).width;h(e)&&(o=45>r?0:r-45),n.fillText(t.value,t.x-o,t.y-1)}},E=function(t,e){var o=t.datasets[0].points[e.index],r=t.scale;if(n.beginPath(),"vertical"===e.orientation)n.moveTo(o.x,r.startPoint+24),n.strokeStyle=e.color,n.fillStyle=e.color,n.lineTo(o.x,r.endPoint),n.stroke(),n.textAlign="center",n.fillText(e.label,o.x,r.startPoint+12);else if("horizontal"===e.orientation){n.moveTo(r.startPoint,o.y),n.strokeStyle=e.color,n.fillStyle=e.color,n.lineTo(t.chart.width,o.y),n.stroke(),n.textAlign="center";var a=n.measureText(e.label).width;n.fillText(e.label,parseInt(a/2)+5,o.y-1)}};Chart.CustomScale=Chart.Scale.extend({initialize:function(){var t=function(t,e,n){t.font=e;var o=0;return Chart.helpers.each(n,function(e){var n=t.measureText(e).width;o=n>o?n:o}),o};this.calculateXLabelRotation=function(){this.ctx.font=this.font;var e=this.ctx.measureText(this.xLabels[this.xLabels.length-1]).width;if(this.xScalePaddingRight=e/2+3,this.xLabelRotation=0,this.display){var n=t(this.ctx,this.font,this.xLabels);this.xLabelWidth=n}else this.xLabelWidth=0,this.xScalePaddingRight=this.padding;this.xScalePaddingLeft=0},Chart.Scale.prototype.initialize.apply(this,arguments)},draw:function(){var t=Chart.helpers,e=t.each,n=t.aliasPixel,o=this.ctx,r=(this.endPoint-this.startPoint)/this.steps,a=Math.round(this.xScalePaddingLeft);this.display&&(o.fillStyle=this.textColor,o.font=this.font,e(this.yLabels,function(e,n){var i=this.endPoint-r*n,s=Math.round(i);o.textAlign="right",o.textBaseline="middle",this.showLabels&&o.fillText(e,a-10,i),o.beginPath(),n>0?(o.lineWidth=this.gridLineWidth,o.strokeStyle=this.gridLineColor):(o.lineWidth=this.lineWidth,o.strokeStyle=this.lineColor),s+=t.aliasPixel(o.lineWidth),o.moveTo(a,s),o.lineTo(this.width,s),o.stroke(),o.closePath(),o.lineWidth=this.lineWidth,o.strokeStyle=this.lineColor,o.beginPath(),o.moveTo(a-5,s),o.lineTo(a,s),o.stroke(),o.closePath()},this),e(this.xLabels,function(t,e){var r=!1;"function"==typeof this.labelsFilter&&this.labelsFilter(e)&&(r=!0);var a=this.calculateX(e)+n(this.lineWidth),i=this.calculateX(e-(this.offsetGridLines?.5:0))+n(this.lineWidth);o.beginPath(),e>0?(o.lineWidth=this.gridLineWidth,o.strokeStyle=this.gridLineColor):(o.lineWidth=this.lineWidth,o.strokeStyle=this.lineColor),o.moveTo(i,this.endPoint),o.lineTo(i,this.startPoint-12),o.stroke(),o.closePath(),o.lineWidth=this.lineWidth,o.strokeStyle=this.lineColor,o.beginPath(),o.moveTo(i,this.endPoint),r?o.lineTo(i,this.endPoint):o.lineTo(i,this.endPoint+5),o.stroke(),o.closePath(),o.save(),o.translate(a,this.endPoint+8),o.textAlign="center",o.textBaseline="top",r||o.fillText(t,0,0),o.restore()},this))}}),Chart.types.Line.extend({name:"LineChartSpots",initialize:function(t){this.options.labelsFilter=t.labelsFilter||null,Chart.types.Line.prototype.initialize.apply(this,arguments)},draw:function(){var t=this.datasets[0],e=this;t.points.forEach(function(t,e){t.fillColor=S(o.chartData.epochLabels[e],e)}),Chart.types.Line.prototype.draw.apply(this,arguments),x(t.points),t.points.forEach(function(t,e){w(t,e)}),c.isDefined(this.options.regions)&&this.options.regions.forEach(function(t){b(e,t)}),c.isDefined(this.options.gridLines)&&this.options.gridLines.forEach(function(t){E(e,t)})},buildScale:function(t){var e=Chart.helpers,n=this,o=function(){var t=[];return n.eachPoints(function(e){t.push(e.value)}),t},r={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,labelsFilter:this.options.labelsFilter,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:t.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(t){var n=e.calculateScaleRange(o(),t,this.fontSize,this.beginAtZero,this.integersOnly);e.extend(this,n)},xLabels:t,font:e.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.pointDotRadius+this.options.pointDotStrokeWidth,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&e.extend(r,{calculateYRange:e.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}),this.scale=new Chart.CustomScale(r)}});var I=function(){o.chartJS.destroy(),s(),t=null,n=null,i=0,d=!1,f=!1,g=null},C=function(e){t=document.getElementById(e),null!==t&&(n=t.getContext("2d"),g=l(),g.setDistance(t,o.tickCount))},O=function(t){return c.isDefined(o.chartOptions.regions)?o.chartOptions.regions.indexOf(t):-1},A=function(t){c.isDefined(o.chartOptions.regions)||(o.chartOptions.regions=[]),O(t)<0&&o.chartOptions.regions.push(t)},P=function(t){var e=O(t);e>=0&&o.chartOptions.regions.splice(e,1)},R=function(t){g.setStartPosition(i,t.center.x),d=!0},L=function(t){f||Y(g.stepCount(i,t.center.x)),g.stop(),d=!1},F=function(){f=!0},N=function(){f=!1},U=function(t){c.isDefined(o.chartOptions.gridLines)||(o.chartOptions.gridLines=[]),o.chartOptions.gridLines.push(t)},M=function(t,e){if(o.chartData.labels=[],o.chartData.epochLabels=t,t.forEach(function(t,e){o.chartData.labels.push(c.getTickTime(t))}),o.chartData.datasets[0].data=e,c.isDefined(o.chartJS)&&o.chartJS.destroy(),c.isDefined(n)){var r=new Chart(n);o.chartJS=r.LineChartSpots(o.chartData,o.chartOptions)}},V=function(t){o.chartOptions.gridLines=[],r.forEach(function(t){t.resetSpotShowing()});var e=[],n=[];t.forEach(function(t,o){var a=parseInt(t.time);r.forEach(function(t){t.viewSpots(o,a)}),e.push(a),n.push(t.price)}),r.forEach(function(t){t.viewRegions()}),M(e,n)},z=function(t){var e,n;t.forEach(function(t,o){var a=parseInt(t.time),i=t.price;r.forEach(function(t){t.addSpots(o,a,i)}),e=parseInt(t.time),n=t.price}),r.forEach(function(t){t.addRegions(e,n)})},W=function(t){c.isDefined(e)&&(e.addTick(t),e.getHistory(0,o.capacity,z),0!==i||d||f?Y(1,!1):e.getHistory(i,o.tickCount,V))},q=function(t){c.isDefined(e)||(e=u(o.capacity)),e.addHistory(t),e.getHistory(0,o.capacity,z),e.getHistory(i,o.tickCount,V)},G=function(t){},J=function(t){},H=function(n){var r,a;if("in"===n)r=parseInt(o.tickCount/1.2),a=r>o.minTickCount;else{if("out"!==n)return;r=parseInt(1.2*o.tickCount),a=r<o.maxTickCount}a&&(o.tickCount=r,e.getHistory(i,o.tickCount,V),g.setDistance(t,o.tickCount))},B=function(){H("out")},j=function(){H("in")},Y=function(t,n){if(0!==t){var r=i+t;0>r?r=0:r>=o.capacity-o.tickCount&&(r=o.capacity-o.tickCount-1),r!==i&&(i=r,(!c.isDefined(n)||n)&&e.getHistory(i,o.tickCount,V))}},K=function(t){!f&&g.isStep(t,o.tickCount)&&Y(g.stepCount(i,t.center.x))},X=function(){return o.capacity},Z=function(){return o.tickCount},Q=function(){return i},tt=function(t){t&&(c.digitTrade(t)&&(t.duration-=1),r.push(p(t)),i=0)},et={addTick:W,addHistory:q,addCandles:G,addOhlc:J};return{dragStart:R,dragEnd:L,zoomIn:j,zoomOut:B,zoomStart:F,zoomEnd:N,dragRight:K,dragLeft:K,getCapacity:X,getTickCount:Z,getDataIndex:Q,addContract:tt,historyInterface:et,addGridLine:U,addRegion:A,removeRegion:P,drawChart:C,destroy:I}},f=function(t){n.drawChart(t)},g=function(){n.destroy(),r.forEach(function(t,e){t.setNotBroadcastable()}),e=null};return n=d(),{destroy:g,drawChart:f,dragStart:n.dragStart,dragEnd:n.dragEnd,zoomIn:n.zoomIn,zoomOut:n.zoomOut,zoomStart:n.zoomStart,zoomEnd:n.zoomEnd,dragRight:n.dragRight,dragLeft:n.dragLeft,getCapacity:n.getCapacity,addContract:n.addContract,historyInterface:n.historyInterface}}]),angular.module("binary").service("cleanupService",["$translate","proposalService",function(t,e){this.run=function(){e.remove()}}]),angular.module("binary").factory("delayService",function(){var t={},e={},n=function(t,n,o){var r=0;return{run:function(a){var i=function(){e[o]=(new Date).getTime(),t.apply(this,n)};0!==a?r=setTimeout(function(){i()},a):i()},cancel:function(){clearTimeout(r)}}};return{update:function(o,r,a,i){var s=(new Date).getTime();if(t.hasOwnProperty(o)){var c=a-(s-e[o]);a=c>0?c:0,t[o].cancel()}else a=0,e[o]=s;t[o]=n(r,i,o),t[o].run(a)},remove:function(n){t.hasOwnProperty(n)&&(t[n].cancel(),delete t[n],delete e[n])}}}),angular.module("binary").service("languageService",["$rootScope","$translate","cleanupService",function(t,e,n){this.update=function(e){localStorage.language=e,t.$broadcast("language:updated"),this.set(e)},this.set=function(o){if(o)var r=o;else var r=localStorage.language||"en";n.run(),t.$broadcast("language:updated"),e.use(r)},this.read=function(){var t=localStorage.language;return t?t:"en"},this.remove=function(){localStorage.removeItem("language"),n.run()}}]),angular.module("binary").factory("localStorageService",function(){var t={},e=function(t,e,n){var o=-1;return t.forEach(function(r,a){t[a][e]===n&&(o=a)}),o};return t.removeToken=function(t){if(localStorage.hasOwnProperty("accounts")){var n=JSON.parse(localStorage.accounts),o=e(n,"token",t);o>-1&&(n.splice(o),localStorage.accounts=JSON.stringify(n))}},t.getDefaultToken=function(){if(localStorage.accounts&&JSON.parse(localStorage.accounts)instanceof Array){var t=JSON.parse(localStorage.accounts),n=e(t,"is_default",!0);if(n>-1)return t[n].token}return null},t}),angular.module("binary").service("marketService",["websocketService","proposalService","config",function(t,e,n){var o=function(t){var e={index:["R_100","R_25","R_50","R_75"],BEARBULL:["RDBEAR","RDBULL"],MOONSUN:["RDMOON","RDSUN"],MARSVENUS:["RDMARS","RDVENUS"],YANGYIN:["RDYANG","RDYIN"]},n=[],o=[];return Object.keys(e).forEach(function(r){var a=[],i=-1;t.forEach(function(t,n){t.symbol==e[r][0]&&(i=n)}),0>i||(e[r].forEach(function(n,i){var s=-1;t.forEach(function(t,n){t.symbol==e[r][i]&&(s=n)}),s>=0&&(a.push(t[s]),o.push(s))}),a.sort(),n=n.concat(a))}),t.forEach(function(t,e){o.indexOf(e)<0&&n.push(t)}),n},r=function(t){return t.sort(function(t,e){return t.display_name>e.display_name?1:t.display_name<e.display_name?-1:0}),t=o(t)};this.fixOrder=function(){if(sessionStorage.active_symbols){var t=JSON.parse(sessionStorage.active_symbols);Object.keys(t).forEach(function(e){t[e]=r(t[e])}),sessionStorage.active_symbols=JSON.stringify(t)}},this.getActiveMarkets=function(){if(!sessionStorage.active_symbols)return[];var t=JSON.parse(sessionStorage.active_symbols);return Object.keys(t)},this.getAllSymbolsForAMarket=function(t){if(!t||!sessionStorage.active_symbols||!sessionStorage.asset_index)return[];var e=JSON.parse(sessionStorage.active_symbols)[t],o=JSON.parse(sessionStorage.asset_index),r=n.assetIndexes,a=[];return e.map(function(t){for(i=0;i<o.length;i++)if(t.symbol===o[i][r.symbol]){for(var e=o[i][r.contracts],n=0;n<e.length;n++)if(-1!==e[n][r.contractFrom].indexOf("t")){a.push(t);break}break}o.splice(i,1)}),a},this.getSymbolDetails=function(e){t.sendRequestFor.contractsForSymbol(e)},this.getDefault={market:function(t){var n=e.get();return n&&n.passthrough&&n.passthrough.market&&t[n.passthrough.market]?n.passthrough.market:_.findKey(t,function(t){return t})},symbol:function(t,n){var o=e.get();return o&&o.passthrough&&o.passthrough.market&&o.symbol&&o.passthrough.market==t?o.symbol:n[0].symbol},tradeType:function(t){if(_.isEmpty(t))return null;var n=e.get(),o=n.contract_type,r=t[0].value;return t.forEach(function(t,e){return t.value==o?void(r=o):void 0}),r},tick:function(){var t=e.get();return t.duration?t.duration:5},digit:function(){var t=e.get();return t.barrier?t.barrier:0},basis:function(){var t=e.get();return t.basis?t.basis:"payout"},amount:function(){var t=e.get();return isNaN(t.amount)?5:t.amount}},this.getTradeTypes=function(t){
var e=n.tradeTypes,o=[];return e.forEach(function(e,n){for(var r in t)if(t.hasOwnProperty(r)&&e.value===r){for(var a=!1,i=0;i<t[r].length;i++){var s=t[r][i].min_contract_duration;s&&s.toString().match(/^\d+t$/)&&(a=!0)}a&&o.push(e)}}),o},this.removeActiveSymbols=function(){sessionStorage.active_symbols=null},this.removeAssetIndex=function(){sessionStorage.asset_index=null},this.hasActiveSymobols=function(){return sessionStorage.active_symbols},this.hasAssetIndex=function(){return sessionStorage.asset_index}}]),angular.module("binary").service("proposalService",["websocketService","appStateService",function(t,e){var n=function(t){var e={subscribe:1,proposal:1,symbol:t.symbol,contract_type:t.contract_type,duration:t.duration,basis:t.basis,currency:t.currency||"USD",amount:isNaN(t.amount)||0==t.amount?0:t.amount||5,duration_unit:"t",passthrough:t.passthrough};return["PUT","CALL","DIGITEVEN","DIGITODD"].indexOf(t.contract_type)>-1?(delete t.digit,delete t.barrier):t.digit>=0?e.barrier=t.digit:t.barrier>=0&&(e.barrier=t.barrier),e};this.update=function(t){t&&(localStorage.proposal=JSON.stringify(n(t)))},this.send=function(n){t.sendRequestFor.forgetProposals(),t.sendRequestFor.proposal(JSON.parse(localStorage.proposal)),e.waitForProposal=!0},this.get=function(){return localStorage.proposal?JSON.parse(localStorage.proposal):!1},this.remove=function(){localStorage.removeItem("proposal")},this.getCurrencies=function(){t.sendRequestFor.currencies()}}]),angular.module("binary").factory("websocketService",["$rootScope","localStorageService","alertService","appStateService",function(t,e,n,o){var r="",a=function(t){3===r.readyState?(s(),setTimeout(function(){a(t)},1e3)):1===r.readyState?t():r instanceof WebSocket?setTimeout(function(){a(t)},1e3):(s(),setTimeout(function(){a(t)},1e3))},i=function(t){a(function(){r.send(JSON.stringify(t))})},s=function(){var n=localStorage.language||"en";o.isLoggedin=!1,r=new WebSocket("wss://ws.binaryws.com/websockets/v3?l="+n),r.onopen=function(){i({ping:1});var n=e.getDefaultToken();if(n){var o={authorize:n,passthrough:{type:"reopen-connection"}};i(o)}console.log("socket is opened"),t.$broadcast("connection:ready")},r.onmessage=function(t){c(t)},r.onclose=function(e){console.log("socket is closed ",e),s(),console.log("socket is reopened"),o.isLoggedin=!1,t.$broadcast("connection:reopened")},r.onerror=function(e){3==e.target.readyState&&t.$broadcast("connection:error"),o.isLoggedin=!1}};t.$on("language:updated",function(){s()});var c=function(r){var a=JSON.parse(r.data);if(a){var i=a.msg_type;switch(i){case"authorize":a.authorize?(a.authorize.token=a.echo_req.authorize,window._trackJs.userId=a.authorize.loginid,o.isLoggedin=!0,t.$broadcast("authorize",a.authorize,a.req_id,a.passthrough)):(a.hasOwnProperty("error")&&"InvalidToken"===a.error.code&&e.removeToken(a.echo_req.authorize),t.$broadcast("authorize",!1),o.isLoggedin=!1);break;case"active_symbols":var s=a.active_symbols,c=_.groupBy(s,"market"),l={};for(var u in c)c.hasOwnProperty(u)&&1==c[u][0].exchange_is_open&&(l[u]=c[u]);sessionStorage.hasOwnProperty("active_symbols")&&sessionStorage.active_symbols==JSON.stringify(l)||(sessionStorage.active_symbols=JSON.stringify(l),t.$broadcast("symbols:updated"));break;case"asset_index":sessionStorage.hasOwnProperty("asset_index")&&sessionStorage.asset_index==JSON.stringify(a.asset_index)||(sessionStorage.asset_index=JSON.stringify(a.asset_index),t.$broadcast("assetIndex:updated"));break;case"payout_currencies":t.$broadcast("currencies",a.payout_currencies);break;case"proposal":a.proposal?t.$broadcast("proposal",a.proposal):a.error&&t.$broadcast("proposal:error",a.error);break;case"contracts_for":var p=(a.echo_req.contracts_for,_.groupBy(a.contracts_for.available,"contract_type"));t.$broadcast("symbol",p);break;case"buy":a.error?(t.$broadcast("purchase:error",a.error),n.displayError(a.error.message)):t.$broadcast("purchase",a);break;case"balance":a.error&&"AlreadySubscribed"===a.error.code||t.$broadcast("balance",a.balance);break;case"tick":t.$broadcast("tick",a);break;case"history":t.$broadcast("history",a);break;case"candles":t.$broadcast("candles",a);break;case"ohlc":t.$broadcast("ohlc",a);break;case"portfolio":t.$broadcast("portfolio",a.portfolio);break;case"profit_table":t.$broadcast("profit_table:update",a.profit_table,a.echo_req.passthrough);break;case"sell_expired":t.$broadcast("sell:expired",a.sell_expired);break;case"proposal_open_contract":t.$broadcast("proposal:open-contract",a.proposal_open_contract)}}},l={};return l.init=function(){setInterval(function t(){return r&&3!==r.readyState||s(),t}(),1e3)},l.authenticate=function(t,e){e=e,o.isLoggedin=!1;var n={authorize:t};for(key in e)e.hasOwnProperty(key)&&(n[key]=e[key]);i(n)},l.sendRequestFor={symbols:function(){var t={active_symbols:"brief"};i(t)},assetIndex:function(){var t={asset_index:1};i(t)},currencies:function(){var t={payout_currencies:1};i(t)},contractsForSymbol:function(t){var e={contracts_for:t};i(e)},ticksForSymbol:function(t){var e={ticks:t};i(e)},forgetAll:function(t){var e={forget_all:t};i(e)},forgetStream:function(t){var e={forget:t};i(e)},forgetProposals:function(){var t={forget_all:"proposal"};i(t)},forgetTicks:function(){var t={forget_all:"ticks"};i(t)},proposal:function(t){i(t)},purchase:function(t,e){var n={buy:t,price:e||0};i(n)},balance:function(){var t={balance:1,subscribe:1};i(t)},portfolio:function(){var t={portfolio:1};i(t)},profitTable:function(t){var e={profit_table:1};for(key in t)t.hasOwnProperty(key)&&(e[key]=t[key]);i(e)},ticksHistory:function(t){t.ticks_history&&i(t)},openContract:function(t,e){var n={};n.proposal_open_contract=1,t&&(n.contract_id=t);for(key in e)e.hasOwnProperty(key)&&(n[key]=e[key]);i(n)},sellExpiredContract:function(){var t={sell_expired:1};i(t)}},l}]),angular.module("binary").directive("changeAccount",["accountService","websocketService","$state","appStateService",function(t,e,n,o){return{restrict:"E",templateUrl:"templates/components/accounts/change-account.template.html",link:function(r,a){var i=function(){r.accounts=t.getAll(),r.selectedAccount=t.getDefault().token},s=function(){o.isLoggedin?(e.sendRequestFor.symbols(),e.sendRequestFor.assetIndex()):setTimeout(s,500)};i(),r.updateAccount=function(e){r.setDataLoaded(!1),t.setDefault(e),t.validate(),s()},r.navigateToManageAccounts=function(){n.go("accounts")}}}}]),angular.module("binary").directive("manageAccounts",["accountService","alertService","cleanupService","$state","languageService","marketService","proposalService","appStateService",function(t,e,n,o,r,a,i,s){return{restrict:"E",templateUrl:"templates/components/accounts/manage-accounts.template.html",link:function(n,o){var c=null;n.accounts=t.getAll(),n.$on("authorize",function(o,a,i){n.showSpinner=!1,i===c&&(a?(t.isUnique(a.loginid)?(t.add(a),t.setDefault(a.token),n.accounts=t.getAll(),n.$$phase||n.$apply()):n.settingDefault?n.settingDefault=!1:e.accountError.tokenNotUnique(),r.set()):e.accountError.tokenNotAuthenticated())}),n.$on("token:remove",function(e,o){t.remove(o),n.accounts=t.getAll(),n.$$phase||n.$apply()}),n.addAccount=function(o){c=(new Date).getTime(),n.showSpinner=!1,o&&15===o.length?(n.showSpinner=!0,t.validate(o,{req_id:c})):e.accountError.tokenNotValid()},n.removeAccount=function(t){e.confirmAccountRemoval(t)},n.setAccountAsDefault=function(e){c=(new Date).getTime(),n.settingDefault=!0,i.remove(),a.removeActiveSymbols(),a.removeAssetIndex(),s.isLoggedin=!1,t.setDefault(e),t.validate(null,{req_id:c}),n.accounts=t.getAll()}}}}]),angular.module("binary").directive("signin",["accountService","languageService","websocketService","alertService","$state","$ionicPopup",function(t,e,n,o,r,a){return{restrict:"E",templateUrl:"templates/components/accounts/signin.template.html",link:function(a,i){var s=function(){n.init(),a.language=e.read()};s(),a.$on("authorize",function(n,i){a.showSpinner=!1,i?(t.isUnique(i.loginid)&&(t.add(i),t.setDefault(i.token)),e.set(),a.token="",r.go("options")):o.accountError.tokenNotAuthenticated()}),a.signIn=function(){var t=a.token;e.update(a.language),a.showSpinner=!1,t&&15===t.length?(a.showSpinner=!0,n.authenticate(t)):o.accountError.tokenNotValid()},a.changeLanguage=function(){e.update(a.language)}}}}]),angular.module("binary").directive("appUpdate",["$ionicPlatform",function(t){return{scope:{},restrict:"E",templateUrl:"templates/components/codepush/app-update.template.html",link:function(e,n,o,r){e.hide=function(){e.isShown=!1,e.showSpinner=!1,e.isDownloading=!1,e.$$phase||e.$root.$$phase||e.$apply()},t.ready(function(){e.isShown=!1,e.showSpinner=!1,e.isDownloading=!0,e.progress=0,window.codePush&&codePush.sync(function(t){switch(e.isShown=!0,e.showSpinner=!1,e.isDownloading=!1,t){case SyncStatus.UPDATE_INSTALLED:e.isDownloading=!1,e.message="update.installed",setTimeout(e.hide,5e3);break;case SyncStatus.UP_TO_DATE:e.message="update.up_to_date",setTimeout(e.hide,5e3);break;case SyncStatus.UPDATE_IGNORED:break;case SyncStatus.ERROR:e.isDownloading=!1,e.message="update.error",setTimeout(e.hide,5e3);break;case SyncStatus.CHECKING_FOR_UPDATE:e.message="update.check_for_update",e.showSpinner=!0;break;case SyncStatus.AWAITING_USER_ACTION:break;case SyncStatus.DOWNLOADING_PACKAGE:e.isDownloading=!0,e.message="update.downloading";break;case SyncStatus.INSTALLING_UPDATE:e.message="installing",e.showSpinner=!0}e.$$phase||e.$root.$$phase||e.$apply()},{installMode:InstallMode.IMMEDIATE,updateDialog:!0},function(t){e.progress=100*t.receivedBytes/t.totalBytes,e.$$phase||e.$root.$$phase||e.$apply()})})}}}]),angular.module("binary").directive("digitsOption",["marketService",function(t){return{restrict:"E",templateUrl:"templates/components/options/digits.template.html",link:function(e,n,o){e.attrs=o;var r=function a(a){var t=e.digits.indexOf(a);0>t||(e.digits.splice(t,1),e.$parent.selected.digit==a&&(e.$parent.selected.digit=e.digits[0]))};e.digits=[0,1,2,3,4,5,6,7,8,9],e.$parent.selected.digit=t.getDefault.digit(),e.$parent.$watch("hideDigit",function(n){null!=e.$parent&&(e.digits=[0,1,2,3,4,5,6,7,8,9],e.$parent.selected.digit=t.getDefault.digit(),isNaN(n)||r(parseInt(n)))}),e.updateDigit=function(t){e.$parent.selected.digit=t},e.getNgDisabled=function(){return e.attrs.ngDisabled?e.$eval(e.attrs.ngDisabled):!1}}}}]),angular.module("binary").directive("marketsOption",["marketService","proposalService","alertService",function(t,e,n){return{restrict:"E",templateUrl:"templates/components/options/markets.template.html",link:function(e,o){e.showSymbolWarning=!0;var r=function(o){e.symbols=t.getAllSymbolsForAMarket(o),e.symbols.length>0?(e.$parent.selected.symbol=t.getDefault.symbol(o,e.symbols),t.getSymbolDetails(e.$parent.selected.symbol)):(e.$broadcast("symbol",[]),e.showSymbolWarning&&(e.showSymbolWarning=!1,n.displaySymbolWarning("alert.no_underlying"),e.$watch(function(){return e.$parent.selected.market},function(t,n){t!==n&&(e.showSymbolWarning=!0)}))),e.$$phase||e.$apply()},a=function(){if(t.hasActiveSymobols()&&t.hasAssetIndex())try{t.fixOrder();var n=t.getActiveMarkets();e.market={random:-1!==n.indexOf("random")?!0:!1},e.$parent.selected.market=t.getDefault.market(e.market),r(e.$parent.selected.market),e.$$phase||e.$apply()}catch(o){console.log(o)}};a(),e.$on("symbols:updated",function(t,e){a()}),e.$on("assetIndex:updated",function(t,e){a()}),e.updateMarket=function(t){e.setDataLoaded(!1),e.$parent.selected.market=t,r(e.$parent.selected.market)}}}}]),angular.module("binary").directive("payoutStakeOption",["marketService",function(t){return{restrict:"E",templateUrl:"templates/components/options/payout-stake.template.html",link:function(e,n){e.$parent.selected.basis=t.getDefault.basis(),e.updateBasis=function(t){e.$parent.selected.basis=t}}}}]),angular.module("binary").directive("symbolsOption",["marketService","alertService","config",function(t,e,n){return{restrict:"E",templateUrl:"templates/components/options/symbols.template.html",link:function(e,o){e.tradeTypes=n.tradeTypes,e.$on("symbol",function(n,o){_.isEmpty(o)?e.setDataLoaded(!0,!1):(e.tradeTypes=t.getTradeTypes(o),e.$parent.selected.tradeType=t.getDefault.tradeType(e.tradeTypes),e.setDataLoaded(!0)),e.$$phase||e.$apply()}),e.updateSymbol=function(n){e.$parent.selected.symbol=n,t.getSymbolDetails(e.$parent.selected.symbol)}}}}]),angular.module("binary").directive("ticksOption",["marketService",function(t){return{restrict:"E",templateUrl:"templates/components/options/ticks.template.html",link:function(e,n){e.ticks=[5,6,7,8,9,10],e.$parent.selected.tick=t.getDefault.tick(),e.updateTick=function(t){e.$parent.selected.tick=t}}}}]),angular.module("binary").directive("tradeCategory",["marketService","config","$ionicScrollDelegate",function(t,e,n){return{restrict:"E",templateUrl:"templates/components/options/trade-category.template.html",link:function(t,o){t.tradeCategories=e.tradeCategories,t.$parent.$watch("scope.tradeTypes",function(n,o){var r=Object.keys(_.groupBy(n,"category"));t.tradeCategories=_.filter(e.tradeCategories,function(t){return r.indexOf(t.value)})}),t.$parent.$watch("selected",function(n){if(n.tradeType){var o=_.find(e.tradeTypes,["value",n.tradeType]);t.updateTradeType(o.category)}},!0),t.updateTradeType=function(n){var o=_.find(e.tradeTypes,["category",n]);t.$parent.selected.tradeType=o.value,t.$parent.selected.tradeCategory=n,t.$parent.displayDigits=!1,t.$parent.hideDigit="",o.digits===!0&&("OVER/UNDER"==n&&(9==t.$parent.selected.digit?t.$parent.selected.tradeType="DIGITUNDER":t.$parent.selected.tradeType="DIGITOVER"),t.$parent.displayDigits=!0,t.$parent.selected.barrier||t.$parent.selected.digit||(t.$parent.selected.digit=0))},t.$parent.$watch(function(){var t=angular.element(document).find("digits-option").hasClass("ng-hide");return t},function(){n.resize()},!1)}}}]),angular.module("binary").directive("contractSummary",["websocketService",function(t){return{restrict:"E",templateUrl:"templates/components/trades/contract-summary.template.html",link:function(t,e){t.basis=t.$parent.proposalToSend.basis||"payout",t.backToOptionPage=function(){$(".contract-purchase button").attr("disabled",!1),t.setTradeMode(!0)}}}}]),angular.module("binary").directive("longCode",["websocketService",function(t){return{restrict:"E",templateUrl:"templates/components/trades/longcode.template.html",link:function(t,e){t.$parent.$watch("proposalRecieved",function(e){t.longcode=e?e.longcode:""})}}}]),angular.module("binary").directive("payout",["websocketService","marketService","proposalService","delayService","appStateService",function(t,e,n,o,r){return{restrict:"E",templateUrl:"templates/components/trades/payout.template.html",link:function(t,a){function i(){var e=n.get();e&&(e.amount=parseFloat(t.amount,10),n.update(e),n.send(t.proposal&&t.proposal.id?t.proposal.id:null))}var s=1e3;t.basis=t.$parent.proposalToSend.basis||"payout",t.amount=e.getDefault.amount(),0==t.amount&&(t.amount=5,i()),t.proposalError=null,n.send(),t.$on("$destroy",function(){o.remove("updateProposal")}),t.$parent.$watch("proposalRecieved",function(e){if(e){var n=parseFloat(e.payout)-parseFloat(e.ask_price);e.netProfit=isNaN(n)||0>n?"0":n.toFixed(2),t.proposal=e,t.proposalError=null,t.$parent&&t.$parent.purchaseFrom&&t.$parent.purchaseFrom.amount.$setValidity("InvalidAmount",!0),t.$$phase||t.$apply()}}),t.$on("purchase:error",function(e,n){t.$parent.purchaseFrom&&t.$parent.purchaseFrom.amount.$setValidity("InvalidAmount",!1),t.$$phase||t.$apply()}),t.$on("proposal:error",function(e,n){t.proposalError=n,t.$parent.purchaseFrom&&t.$parent.purchaseFrom.amount.$setValidity("InvalidAmount",!1),t.$$phase||t.$apply()}),t.delayedUpdateProposal=function(){r.waitForProposal=!0,t.$$phase||t.$apply(),o.update("updateProposal",i,s)},t.updateAmount=function(e){t.delayedUpdateProposal()},t.addAmount=function(){var e=parseFloat(t.amount);isNaN(e)&&(e=0),t.amount=1e5>e?Number(e+1).toFixed(2):1e5},t.subtractAmount=function(){var e=parseFloat(t.amount);t.amount=e>2?Number(e-1).toFixed(2):1},t.isObjectEmpty=function(t){return _.isEmpty(t)}}}}]),angular.module("binary").directive("purchase",["websocketService","alertService","$rootScope","appStateService",function(t,e,n,o){return{restrict:"E",templateUrl:"templates/components/trades/purchase.template.html",link:function(e,n,r){e.attrs=r,e.title=r.title?r.title:"trade.buy",e.purchase=function(){if($(".contract-purchase button").attr("disabled",!0),o.purchaseMode=!0,t.sendRequestFor.purchase(e.$parent.proposalRecieved.id,e.$parent.proposalRecieved.ask_price),"undefined"!=typeof analytics){var n=JSON.parse(localStorage.proposal);analytics.trackEvent(e.$parent.account.loginid,n.symbol,n.contract_type,e.$parent.proposalRecieved.payout)}},e.getNgDisabled=function(){return e.attrs.ngDisabled?e.$eval(e.attrs.ngDisabled):!1}}}}]),angular.module("binary").directive("tradeContractChart",["websocketService","chartService",function(t,e){return{restrict:"E",templateUrl:"templates/components/trades/trade-contract-chart.template.html",link:function(n,o){var r=function(){var o=n.$parent.proposalToSend.symbol;t.sendRequestFor.forgetTicks(),t.sendRequestFor.ticksHistory({ticks_history:o,end:"latest",count:e.getCapacity(),subscribe:1})},a=function(){var t="tradeContractChart";e.drawChart(t),n.$parent.chartDragLeft=e.dragLeft,n.$parent.chartDragRight=e.dragRight,n.$parent.chartTouch=e.dragStart,n.$parent.chartRelease=e.dragEnd,n.$parent.chartPinchIn=e.zoomOut,n.$parent.chartPinchOut=e.zoomIn,n.$parent.chartPinchStart=e.zoomStart,n.$parent.chartPinchEnd=e.zoomEnd,r()};a(),n.$on("$destroy",function(t,n){e.destroy()}),n.$on("portfolio",function(t,o){var r=n.$parent.contract.contract_id;"undefined"!=typeof r&&o.contracts.forEach(function(t){t.contract_id==r&&e.addContract({startTime:t.date_start+1,duration:parseInt(n.$parent.proposalToSend.duration),type:n.$parent.proposalToSend.contract_type,barrier:n.$parent.proposalToSend.barrier})})}),n.$on("tick",function(o,r){r&&r.echo_req.ticks_history===n.$parent.proposalToSend.symbol?e.historyInterface.addTick(r.tick):t.sendRequestFor.forgetStream(r.tick.id)}),n.$on("history",function(t,o){o&&o.echo_req.ticks_history===n.$parent.proposalToSend.symbol&&e.historyInterface.addHistory(o.history)}),n.$on("candles",function(t,n){n&&e.historyInterface.addCandles(n.candles)}),n.$on("ohlc",function(t,n){n&&e.historyInterface.addOhlc(n.ohlc)}),n.$on("connection:ready",function(t){r()})}}}]),angular.module("binary").directive("tradeType",["config","proposalService",function(t,e){return{restrict:"E",templateUrl:"templates/components/trades/trade-type.template.html",scope:{proposal:"="},link:function(n,o){function r(){n.tradeCategory=_.find(t.tradeTypes,["value",n.proposal.contract_type]).category,n.tradeTypes=_.filter(t.tradeTypes,["category",n.tradeCategory])}function a(t){n.proposal=e.get(),n.proposal&&(n.proposal.contract_type=t,e.update(n.proposal),e.send(n.proposal&&n.proposal.id?n.proposal.id:null))}n.changeTradeType=function(){a(n.proposal.contract_type)},n.checkDigitsConditions=function(t){return"DIGITOVER"===t&&9==n.proposal.barrier?!0:"DIGITUNDER"===t&&0==n.proposal.barrier?!0:!1},r()}}}]),angular.module("binary").directive("appVersion",["$ionicPlatform","appVersionService",function(t,e){return{scope:{"class":"@"},restrict:"E",templateUrl:"templates/components/utils/app-version.template.html",link:function(n){t.ready(function(){window.cordova?cordova.getAppVersion(function(t){n.appVersion=t},function(t){console.log(t)}):e.getAppVersion().success(function(t){n.appVersion=t.version}).error(function(t){n.appVersion="0.0.0"})})}}}]),angular.module("binary").directive("connectionStatus",function(){return{scope:{},restrict:"E",templateUrl:"templates/components/utils/connection-status.template.html",link:function(t,e,n,o){t.isConnectionError=!1,t.$on("connection:error",function(){t.isConnectionError=!0,t.$$phase||t.$apply()}),t.$on("connection:ready",function(){t.isConnectionError=!1,t.$$phase||t.$apply()})}}}),angular.module("binary").directive("logoSpinner",function(){return{restrict:"E",replace:!0,scope:{start:"="},templateUrl:"templates/components/utils/logo-spinner.template.html"}}),angular.module("binary").directive("onLongPress",["$timeout","$interval",function(t,e){return{restrict:"A",link:function(n,o,r){var a=0,i=r.interval?Number(r.interval):300,s=function(o){n.longPress=!0,r.repetitive&&"true"===r.repetitive?(n.$eval(r.onLongPress),a=e(function(){n.longPress&&n.$eval(r.onLongPress)},i)):a=t(function(){n.longPress&&n.$eval(r.onLongPress)},i)},c=function(o){n.longPress=!1,r.repetitive&&"true"===r.repetitive?e.cancel(a):t.cancel(a),a=void 0,r.onTouchEnd&&n.$apply(function(){n.$eval(r.onTouchEnd)})};o.bind("touchstart",s),o.bind("touchend",c),o.bind("mousedown",s),o.bind("mouseup",c)}}}]),angular.module("binary").directive("stringToNumber",function(){return{require:"ngModel",link:function(t,e,n,o){o.$parsers.push(function(t){return""+parseFloat(parseFloat(t).toFixed(2))}),o.$formatters.push(function(t){return parseFloat(t,10)})}}});